<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Badge con QR Code e Foto</title>
  <script src="https://cdn.rawgit.com/davidshimjs/qrcodejs/gh-pages/qrcode.min.js"></script>
  <style>
    /* Stili per il badge */
    #badge {
      display: inline-block;
      padding: 20px;
      background-color: #f0f0f0;
      border: 2px solid #ccc;
      border-radius: 10px;
      box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
      margin-bottom: 20px;
      position: relative;
    }
    #badgeText {
      font-size: 18px;
      font-weight: bold;
      margin-bottom: 10px;
    }
    #qrcode {
      margin: 0 auto;
    }
    #userImage {
      max-width: 100%;
      max-height: 200px;
      margin-top: 10px;
    }
    /* Stili per il pulsante */
    #downloadButton {
      display: block;
      padding: 10px 20px;
      background-color: #007bff;
      color: #fff;
      border: none;
      border-radius: 5px;
      font-size: 16px;
      cursor: pointer;
      transition: background-color 0.3s;
    }
    #downloadButton:hover {
      background-color: #0056b3;
    }
    /* Stili per i campi di input */
    input[type="text"],
    input[type="password"] {
      width: 100%;
      padding: 10px;
      margin-bottom: 10px;
    }
  </style>
</head>
<body>
  <!-- Form per inserire Nome, Cognome e Password -->
  <form id="userForm">
    <input type="text" id="firstName" placeholder="Nome">
    <input type="text" id="lastName" placeholder="Cognome">
    <input type="password" id="password" placeholder="Password">
  </form>

  <!-- Div per il badge con QR code -->
  <div id="badge">
    <!-- Testo del badge -->
    <div id="badgeText">
      Nome Cognome
    </div>
    <!-- QR code del badge -->
    <div id="qrcode"></div>
    <!-- Immagine utente -->
    <img id="userImage" src="" alt="Foto utente">
  </div>

  <!-- Pulsante per scattare una foto -->
  <button id="takePhotoButton">Scatta Foto</button>

  <!-- Pulsante per scaricare l'immagine del badge -->
  <button id="downloadButton">Scarica Badge</button>

  <script type="text/javascript">
    // Funzione per creare il QR code e aggiungerlo al badge
    function createQRCode() {
      var qrCodeDiv = document.getElementById("qrcode"); // Div per il QR code
      qrCodeDiv.innerHTML = ''; // Svuota il contenuto del div

      var firstName = document.getElementById("firstName").value;
      var lastName = document.getElementById("lastName").value;
      var password = document.getElementById("password").value;
      var text = `${firstName} ${lastName} ${password}`; // Testo per il QR code
      new QRCode(qrCodeDiv, text); // Crea il QR code nel div
    }

    // Funzione per aggiornare il testo del badge con Nome e Cognome inseriti dall'utente
    function updateBadgeText() {
      var firstName = document.getElementById("firstName").value;
      var lastName = document.getElementById("lastName").value;
      var badgeText = `${firstName} ${lastName}`; // Testo del badge
      document.getElementById("badgeText").innerText = badgeText; // Aggiorna il testo del badge
    }

    // Funzione per scattare una foto con la fotocamera
    function takePhoto() {
      var video = document.createElement("video");
      var canvas = document.createElement("canvas");
      var context = canvas.getContext("2d");

      navigator.mediaDevices.getUserMedia({ video: true })
        .then(function (stream) {
          video.srcObject = stream;
          video.play();
          video.addEventListener("loadedmetadata", function () {
            canvas.width = video.videoWidth;
            canvas.height = video.videoHeight;
            context.drawImage(video, 0, 0, canvas.width, canvas.height);
            var userImage = document.getElementById("userImage");
            userImage.src = canvas.toDataURL();
            stream.getTracks().forEach(track => track.stop()); // Stop the camera stream
          });
        })
        .catch(function (error) {
          console.log("Errore nell'acquisizione video:", error);
        });
    }

    // Funzione per scaricare il badge come immagine
    function downloadBadge() {
      // Crea un canvas temporaneo
      var canvas = document.createElement("canvas");
      var ctx = canvas.getContext("2d");

      // Calcola le dimensioni del badge
      var badgeWidth = document.getElementById("badge").offsetWidth;
      var badgeHeight = document.getElementById("badge").offsetHeight;

      // Imposta le dimensioni del canvas
      canvas.width = badgeWidth;
      canvas.height = badgeHeight;

      // Disegna il badge sul canvas
      ctx.fillStyle = "white";
      ctx.fillRect(0, 0, badgeWidth, badgeHeight);

      // Disegna il Nome e Cognome sopra il badge
      var firstName = document.getElementById("firstName").value;
      var lastName = document.getElementById("lastName").value;
      ctx.fillStyle = "black";
      ctx.font = "18px Arial";
      ctx.fillText(firstName + " " + lastName, 10, 30);

      // Disegna l'immagine dell'utente sul badge
      var userImage = document.getElementById("userImage");
      ctx.drawImage(userImage, 10, 50, 100, 100); // Posizione e dimensioni dell'immagine utente

      // Disegna il QR code
      var qrCodeImage = document.getElementById("qrcode").querySelector("img");
      var qrCodeX = (badgeWidth - qrCodeImage.width) / 2;
      var qrCodeY = (badgeHeight - qrCodeImage.height) / 2;
      ctx.drawImage(qrCodeImage, qrCodeX, qrCodeY);

      // Crea un link per il download dell'immagine
      var link = document.createElement("a");
      link.download = "badge.png"; // Nome del file da scaricare
      link.href = canvas.toDataURL("image/png");

      // Aggiungi il link al documento e fai clic automaticamente
      document.body.appendChild(link);
      link.click();

      // Rimuovi il link dal documento
      document.body.removeChild(link);
    }

    // Chiama la funzione per creare il QR code quando il documento Ã¨ pronto
    document.addEventListener("DOMContentLoaded", function () {
      createQRCode();
      updateBadgeText();

      // Aggiungi l'evento click al pulsante di scattare una foto
      document.getElementById("takePhotoButton").addEventListener("click", function () {
        takePhoto();
      });

      // Aggiungi l'evento click al pulsante di download
      document.getElementById("downloadButton").addEventListener("click", function () {
        downloadBadge();
      });
    });
  </script>
</body>
</html>
